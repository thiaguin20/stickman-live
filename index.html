<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Stickman na Ponte</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      background: black;
      font-family: Arial, sans-serif;
    }

    #game {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: black;
      overflow: hidden;
    }

    #stars-wrapper {
      position: absolute;
      width: 200%;
      height: 100%;
      display: flex;
      z-index: 0;
      overflow: hidden;
    }

    .stars {
      width: 100%;
      height: 100%;
      background: url('https://www.transparenttextures.com/patterns/stardust.png') repeat;
      animation: scrollStars 20s linear infinite;
    }

    @keyframes scrollStars {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

 .bridge-container {
  position: absolute;
  bottom: 25vh;
  width: 300vw;
  height: 80px; /* altura fixa */
  z-index: 1;
  display: flex;
  animation: moveBridge 6s linear infinite;
}

.bridge {
  width: 100vw;
  height: 100px;
  background: url('assets/ponte.png') repeat-x;
  background-size: auto;
  flex-shrink: 0;
}



@keyframes moveBridge {
  0% { transform: translateX(0); }
  100% { transform: translateX(-100vw); }
}



    @keyframes moveBridge {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100vw); }
    }

    #stickman {
      position: absolute;
      bottom: 27vh;
      left: 500px;
      width: 8vw;
      height: auto;
      z-index: 2;
      filter: drop-shadow(0 0 10px white);
    }

    .enemy {
      position: absolute;
      bottom: 27vh;
      width: 7vw;
      height: auto;
      z-index: 2;
    }

    .enemy.fade {
      animation: fadeOut 0.3s forwards;
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        transform: scale(0.8);
      }
    }

    #score {
      position: absolute;
      top: 150px;
      left: 500px;
      color: white;
      font-size: 2.5vh;
      z-index: 3;
    }

    #reward-bar {
      position: absolute;
      top: 200px;
      left: 0;
      width: 100%;
      height: 4vh;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 2vh;
      line-height: 4vh;
      overflow: hidden;
      white-space: nowrap;
      z-index: 4;
    }

    #reward-bar span {
      display: inline-block;
      padding-left: 100%;
      animation: scrollRewards 15s linear infinite;
      color: aliceblue;
      font-size: 2.5vh;
    }

    #reward-bar span > img {
      height: 4vh;
      vertical-align: middle;
      margin: 0 6px;
    }

    @keyframes scrollRewards {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
  </style>
</head>
<body>


<script>
  window.onload = function () {
    const music = document.getElementById("bgMusic");
    music.volume = 0.1;
  };
</script>

<div id="game">
  <div id="stars-wrapper">
    <div class="stars"></div>
    <div class="stars"></div>
  </div>

  <div id="score">Derrotados: 0</div>

  <div id="reward-bar">
    <span>
      ‚ù§Ô∏è 100 curtidas = 1 zumbi ‚Ä¢ üë§ Seguidor = 1 zumbi ‚Ä¢ <img src="assets/rosa.png" alt="rosa"> = 2 zumbis ‚Ä¢ <img src="assets/coracodedo.png" alt=""> = 3 zumbis ‚Ä¢ <img src="assets/dino_pequeno.png" alt=""> = 5 zumbis ‚Ä¢ <img src="assets/rosquinha.png" alt=""> = 10 zumbis ‚Ä¢ <img src="assets/bola.png" alt=""> = 15 zumbis ‚Ä¢ <img src="assets/corgi.png" alt=""> = 20 zumbis ‚Ä¢ <img src="assets/arma.png" alt=""> = 30 zumbis ‚Ä¢ <img src="assets/galaxia.png" alt=""> = 50 zumbis
    </span>
  </div>

 <div class="bridge-container">
  <div class="bridge"></div>
  <div class="bridge"></div>
  <div class="bridge"></div>
</div>


  <img id="stickman" src="assets/andar.gif" alt="Stickman">
</div>

<script>
  let derrotados = 0;
  const game = document.getElementById('game');
  const stickman = document.getElementById('stickman');
  const scoreDisplay = document.getElementById('score');
  let enemies = [];
  let attacking = false;
  let usandoChute = false;

  function spawnEnemy(count) {
    for (let i = 0; i < count; i++) {
      const enemy = document.createElement('img');
      enemy.src = 'assets/zumbi.gif';
      enemy.classList.add('enemy');
      const spacing = 10; // em vw
      enemy.style.left = (100 + i * spacing) + 'vw';
      game.appendChild(enemy);
      enemies.push(enemy);
    }
  }

function moveEnemies() {
  const stickmanRect = stickman.getBoundingClientRect();

  for (let i = enemies.length - 1; i >= 0; i--) {
    const enemy = enemies[i];
    let currentLeft = parseFloat(enemy.style.left);
    currentLeft -= 0.5;
    enemy.style.left = currentLeft + 'vw';

    const enemyRect = enemy.getBoundingClientRect();

    const collided = (
      enemyRect.left < stickmanRect.right &&
      enemyRect.right > stickmanRect.left &&
      enemyRect.bottom > stickmanRect.top &&
      enemyRect.top < stickmanRect.bottom
    );

    if (collided && !attacking) {
      atacar(enemy);
      enemies.splice(i, 1);
      continue;
    }

    if (currentLeft < -10) {
      enemy.remove();
      enemies.splice(i, 1);
    }
  }
}




  function playSocoSound() {
    const audio = new Audio('assets/soco.mp3');
    audio.play();
  }

  function playChuteSound() {
    const audio = new Audio('assets/chute.mp3');
    audio.play();
  }

function atacar(enemy) {
  attacking = true;
  usandoChute = !usandoChute;

  if (usandoChute) {
    stickman.src = 'assets/chute1.png';
    playChuteSound();
  } else {
    stickman.src = 'assets/soco1.png';
    playSocoSound();
  }

  // Remove o inimigo instantaneamente
enemy.classList.add("fade");
setTimeout(() => enemy.remove(), 300);


  // S√≥ o reset da imagem do stickman pode continuar com delay
  setTimeout(() => {
    stickman.src = 'assets/andar.gif';
    attacking = false;
  }, 200);
}


  function gameLoop() {
    moveEnemies();
    requestAnimationFrame(gameLoop);
  }

  gameLoop();
</script>
<script>
  const socket = new WebSocket('ws://localhost:8080');

  socket.addEventListener('open', () => {
    console.log('üì° Conectado ao servidor WebSocket');
  });

  socket.addEventListener('message', (event) => {
    const data = JSON.parse(event.data);

    if (data.type === 'zumbi') {
      spawnEnemy(data.count);
      derrotados += data.count;
      scoreDisplay.textContent = `Derrotados: ${derrotados}`;
    }
  });

  socket.addEventListener('error', (err) => {
    console.error('Erro no WebSocket:', err);
  });

  socket.addEventListener('close', () => {
    console.warn('WebSocket desconectado.');
  });
</script>

</body>
</html>




